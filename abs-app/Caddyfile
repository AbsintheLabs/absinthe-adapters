{
    # Global options
    debug

    # Set the maximum request body size to 200KB
    request_body {
        max_size 200KB
    }
}

# Redirect HTTP to HTTPS
adapters.absinthe.networks:80 {
    redir https://{host}{uri} permanent
}

# HTTPS server
adapters.absinthe.networks:443 {
    # Handle API requests
    handle_path /api/* {
        reverse_proxy localhost:3000 {
            header_up Host {http.request.host}
            header_up X-Api-Key {http.request.header.x-api-key}
            timeout 30s
        }
    }

    # Health check endpoint
    handle /health {
        reverse_proxy localhost:3000
    }

    # Respond with 404 for undefined routes
    handle {
        respond "Not Found" 404
    }

    # Enable compression
    encode gzip

    # Log requests
    log {
        output file /var/log/caddy/access.log
        format json
    }
}
