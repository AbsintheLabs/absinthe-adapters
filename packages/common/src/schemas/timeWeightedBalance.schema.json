{
    "$schema": "http://json-schema.org/draft-07/schema#",
    "$id": "https://adapters.absinthe.network/schemas/timeWeightedBalance.schema.json",
    "title": "Time Weighted Balance",
    "description": "Metric reflecting both event value and duration. Calculated as value * duration to provide an exposure measure on the holding period.",
    "type": "object",
    "allOf": [
        {
            "$ref": "./base.schema.json"
        },
        {
            "type": "object",
            "properties": {
                "eventType": {
                    "type": "string",
                    "enum": [
                        "timeWeightedBalance"
                    ]
                },
                "balanceBefore": {
                    "type": "number",
                    "minimum": 0
                },
                "balanceAfter": {
                    "type": "number",
                    "minimum": 0
                },
                "timeWindowTrigger": {
                    "type": "string",
                    "enum": [
                        "transfer",
                        "exhausted"
                    ]
                },
                "startUnixTimestampMs": {
                    "type": "integer",
                    "minimum": 0
                },
                "endUnixTimestampMs": {
                    "type": "integer",
                    "minimum": 0
                },
                "windowDurationMs": {
                    "type": "integer",
                    "minimum": 0
                },
                "startBlockNumber": {
                    "type": "number",
                    "minimum": 0
                },
                "endBlockNumber": {
                    "type": "number",
                    "minimum": 0
                },
                "txHash": {
                    "$ref": "./base.schema.json#/definitions/hex32"
                }
            },
            "required": [
                "eventType",
                "balanceBefore",
                "balanceAfter",
                "timeWindowTrigger",
                "startUnixTimestampMs",
                "endUnixTimestampMs",
                "windowDurationMs"
            ],
            "if": {
                "properties": {
                    "timeWindowTrigger": {
                        "const": "transfer"
                    }
                }
            },
            "then": {
                "required": [
                    "startBlockNumber",
                    "endBlockNumber",
                    "txHash"
                ]
            }
        }
    ]
}